import numpy as np

def find_twr_and_swr():
    """
    Рассчитывает Коэффициент бегущей волны (Кбв) и Коэффициент стоячей волны (КСВ)
    на основе волнового сопротивления линии (W) и сопротивления нагрузки (Zn).
    """
    print("----------------------------------------------------------------------------------------------------------\n"
          "Поиск Кбв и Ксв через волновое сопротивление и сопротивление нагрузки\n")

    try:
        # --- Ввод данных от пользователя ---
        W_input = input("Введите волновое сопротивление линии W (по умолчанию 1): ")
        W = float(W_input) if W_input != '' else 1.0

        Rn_input = input("Введите активную составляющую нагрузки Rn (по умолчанию 0): ")
        Rn = float(Rn_input) if Rn_input != '' else 0.0

        Xn_input = input("Введите реактивную составляющую нагрузки Xn со знаком (по умолчанию 0): ")
        Xn = float(Xn_input) if Xn_input != '' else 0.0

        Zn = complex(Rn, Xn)

    except ValueError:
        print("\nОшибка! Введено некорректное число. Пожалуйста, перезапустите программу"
              "\nПерепроверьте раскладку клавиатуры. Она должна быть EN")
        return

    # --- Расчет ---

    # Защита от деления на ноль в редком случае, когда Zn = -W
    if W + Zn == 0:
        print("\nОшибка! Сопротивление нагрузки равно -W, что приводит к бесконечному отражению.")
        gamma_magnitude = float('inf')
        swr = float('inf')
        twr = 0.0
    else:
        # Шаг 1: Рассчитываем комплексный коэффициент отражения (Gamma)
        # Формула: Γ = (Z_нагрузки - Z_волновое) / (Z_нагрузки + Z_волновое)
        gamma_load = (Zn - W) / (Zn + W)

        # Шаг 2: Находим его модуль (величину), |Γ|. Для этого используется функция abs().
        gamma_magnitude = np.abs(gamma_load)

        # Шаг 3: Рассчитываем Кбв (twr) по его формуле
        # twr = (1 - |Γ|) / (1 + |Γ|)
        twr = (1 - gamma_magnitude) / (1 + gamma_magnitude)

        # Шаг 4: Рассчитываем КСВ (swr) для дополнительной информации
        # swr = (1 + |Γ|) / (1 - |Γ|)
        swr = (1 + gamma_magnitude) / (1 - gamma_magnitude)

    # --- Вывод результата ---
    print(f"\n--- Результаты расчета для W = {W} Ом и Zn = {Zn} Ом ---")
    print(f"Коэффициент бегущей волны (Кбв): {twr:.4f}")
    print(f"Коэффициент стоячей волны (КСВ): {swr:.2f}")

