import numpy as np


def find_Zin_by_twr():
    """
    Рассчитывает входное сопротивление (Zin) линии передачи на заданном
    расстоянии (dz) от ТОЧКИ МИНИМУМА НАПРЯЖЕНИЯ, зная Кбв и волновое сопротивление (W).
    """
    print("----------------------------------------------------------------------------------------------------------\n"
          "Поиск входного сопротивления через Кбв и расстояние от минимума напряжения\n")

    try:
        # --- Ввод данных от пользователя ---
        twr = float(input("Введите коэффициент бегущей волны (Кбв, от 0 до 1): "))

        # Проверка корректности введенного Кбв
        if not (0 <= twr <= 1):
            print("\nОшибка! Кбв должен быть в диапазоне от 0 до 1.")
            return

        dz = float(input("Введите расстояние от точки минимума напряжения, нормированное относительно λ: "))

        W_input = input("Введите волновое сопротивление линии W (по умолчанию 1): ")
        W = float(W_input) if W_input != '' else 1.0

    except ValueError:
        print("\nОшибка! Введено некорректное число. Пожалуйста, перезапустите программу"
              "\nПерепроверьте раскладку клавиатуры. Она должна быть EN")
        return

    # --- Расчет ---
    gamma_magnitude = (1 - twr) / (1 + twr)

    # Шаг 2: Определяем коэффициент отражения в точке минимума напряжения (Gamma_min).
    # В этой точке фаза коэффициента отражения всегда равна -180° (или -π радиан).
    # Поэтому Gamma_min является отрицательным действительным числом.
    # Gamma_min = |Γ| * e^(-j*π) = -|Γ|
    gamma_at_min = -gamma_magnitude

    # Шаг 3: Рассчитываем фазовый сдвиг при движении от минимума на расстояние dz.
    # Это эквивалентно повороту вектора Gamma в комплексной плоскости.
    phase_shift = np.exp(-2j * 2 * np.pi * dz)

    # Шаг 4: Находим входной коэффициент отражения (Gamma_in), повернув Gamma_min на рассчитанный угол.
    gamma_in = gamma_at_min * phase_shift

    # Шаг 5: Преобразуем входной коэффициент отражения (Gamma_in) во входное сопротивление (Zin).
    # Формула: Z = Z0 * (1 + Gamma) / (1 + Gamma)
    Zin_val = W * (1 + gamma_in) / (1 - gamma_in)

    # --- Вывод результата ---
    # Для информации также посчитаем КСВ (SWR), так как он часто используется
    swr = (1 + gamma_magnitude) / (1 - gamma_magnitude)

    print(f"\n--- Результаты расчета ---")
    print(f"Входное сопротивление (Zin) на расстоянии dz = {dz}λ от минимума напряжения составляет:")
    print(f"Zin = {Zin_val.real:.2f}{Zin_val.imag:+.2f}j Ом")
